CREATE OR REPLACE PACKAGE PKG_GDS_MODULO_NOPUBLIKDAS_PTA IS

  -- Author  : BCHOY
  -- Created : 21/11/2017 15:07:11
  -- Purpose : 
  
  -- Public type declarations
  type cursorGDS IS REF CURSOR;

PROCEDURE GDS_LIMPIAR_CONCEPTOS(
  p_PNR           IN varchar2,
  p_Transportador IN varchar2,
  p_RowsAffected  OUT number);

PROCEDURE GDS_LIMPIAR_EVALUACIONES(
  p_PNR           IN varchar2,
  p_RowsAffected  OUT number); 

PROCEDURE GDS_OBTENER_CONCEPTOS(
  p_PNR           IN varchar2,
  p_Transportador IN varchar2,
  p_Cursor        OUT cursorGDS);

END PKG_GDS_MODULO_NOPUBLIKDAS_PTA;

-- // --

CREATE OR REPLACE PACKAGE BODY PKG_GDS_MODULO_NOPUBLIKDAS_PTA IS

PROCEDURE GDS_LIMPIAR_CONCEPTOS (
  p_PNR           IN varchar2,
  p_Transportador IN varchar2,
  p_RowsAffected  OUT number)

AS
BEGIN 
  DELETE FROM TARIFABULK_CONCEPTOS 
  WHERE (UPPER(CODIGO_RESERVA) = UPPER(p_PNR))
  AND (UPPER(ID_TRANSPORTADOR) = UPPER(p_Transportador));

  p_RowsAffected := SQL%ROWCOUNT;  

END GDS_LIMPIAR_CONCEPTOS;

PROCEDURE GDS_LIMPIAR_EVALUACIONES(
  p_PNR           IN varchar2,
  p_RowsAffected  OUT number)

AS
BEGIN 
  DELETE FROM TARIFABULK_EVALUACION 
  WHERE (UPPER(CODIGO_RESERVA) = UPPER(p_PNR));

  p_RowsAffected := SQL%ROWCOUNT;  

END GDS_LIMPIAR_EVALUACIONES;

PROCEDURE GDS_OBTENER_CONCEPTOS(
  p_PNR           IN varchar2,
  p_Transportador IN varchar2,
  p_Cursor        OUT cursorGDS)

AS
BEGIN 
  OPEN p_Cursor FOR 
  SELECT 
    CT.CODIGO_CONCEPTO AS IDCONCEPTO,
    CO.DESCRIPCION_CONCEPTO AS CONCEPTO,
    TC.CODIGO_TIPO_DATO_CONCEPTO AS IDTIPOCONCEPTO,
    TC.DESCRIPCION_TIPO_DATO_CONCEPTO AS TIPOCONCEPTO,
	TC.USAR_COMILLAS AS ENTRECOMILLAS
  FROM TARIFABULK_CONCEPTOS CT
  INNER JOIN TOURCODES_CONCEPTOS CO ON (CT.CODIGO_CONCEPTO = CO.CODIGO_CONCEPTO) 
  INNER JOIN TOURCODES_TIPOSDATOSCONCEPTO TC ON (CO.CODIGO_TIPO_DATO_CONCEPTO = TC.CODIGO_TIPO_DATO_CONCEPTO)
  WHERE (CO.EN_DESUSO = 0)
  AND (CT.CODIGO_RESERVA = UPPER(p_PNR))
  AND (CT.ID_TRANSPORTADOR = UPPER(p_Transportador))
  ORDER BY CT.CODIGO_CONCEPTO ASC;

END GDS_OBTENER_CONCEPTOS;

END PKG_GDS_MODULO_NOPUBLIKDAS_PTA;
