CREATE OR REPLACE PACKAGE PKG_GDS_TARJETAS_CREDITO_PTA IS

  -- Author  : BCHOY
  -- Versi√≥n : 23.10.17
  -- Created : 03/10/2017 15:32:11
  -- Purpose : 
  
  -- Public type declarations
  type cursorGDS IS REF CURSOR;
  
PROCEDURE GDS_LIMPIAR_CONCEPTOS_TDC(
  p_PNR           IN varchar2,
  p_RowsAffected  OUT number);  

PROCEDURE GDS_LIMPIAR_EVALUACIONES_TDC(
  p_PNR           IN varchar2,
  p_RowsAffected  OUT number);  

PROCEDURE GDS_OBTENER_CONCEPTOS_TDC(
  p_PNR           IN varchar2,
  p_IATA          IN number,
  p_Cursor        OUT cursorGDS);

-- // --

CREATE OR REPLACE PACKAGE BODY PKG_GDS_TARJETAS_CREDITO_PTA IS

PROCEDURE GDS_LIMPIAR_CONCEPTOS_TDC(
  p_PNR           IN varchar2,
  p_RowsAffected  OUT number)

AS
BEGIN 
  DELETE FROM MPC_CONCEPTO_TARJ_CRED 
  WHERE (UPPER(COD_RESERVA) = UPPER(p_PNR));

  p_RowsAffected := SQL%ROWCOUNT;  

END GDS_LIMPIAR_CONCEPTOS_TDC;

PROCEDURE GDS_LIMPIAR_EVALUACIONES_TDC(
  p_PNR           IN varchar2,
  p_RowsAffected  OUT number)

AS
BEGIN 
  DELETE FROM MPC_EVALUACION 
  WHERE (UPPER(COD_RESERVA) = UPPER(p_PNR));

  p_RowsAffected := SQL%ROWCOUNT;  

END GDS_LIMPIAR_EVALUACIONES_TDC;

PROCEDURE GDS_OBTENER_CONCEPTOS_TDC(
  p_PNR           IN varchar2,
  p_IATA          IN number,
  p_Cursor        OUT cursorGDS)

AS
BEGIN 
  OPEN p_Cursor FOR 
  SELECT 
    CT.ID_CONCEPTO AS IDCONCEPTO, 
    CO.DESCRIPCION AS CONCEPTO, 
    TC.CODIGO_TIPO_DATO_CONCEPTO AS IDTIPOCONCEPTO, 
    TC.DESCRIPCION_TIPO_DATO_CONCEPTO AS TIPOCONCEPTO 
  FROM MPC_CONCEPTO_TARJ_CRED CT 
  INNER JOIN MPC_CONCEPTO CO ON (CT.ID_CONCEPTO = CO.ID_CONCEPTO) 
  INNER JOIN TOURCODES_TIPOSDATOSCONCEPTO TC ON (CO.ID_TIPO_DE_DATO = TC.CODIGO_TIPO_DATO_CONCEPTO)
  WHERE (CT.COD_RESERVA = UPPER(p_PNR)) 
  AND (CT.ID_IATA = UPPER(p_IATA))
  ORDER BY CT.ID_CONCEPTO ASC;

END GDS_OBTENER_CONCEPTOS_TDC;

END PKG_GDS_TARJETAS_CREDITO_PTA;
